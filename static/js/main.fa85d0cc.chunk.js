(this.webpackJsonpchallenge=this.webpackJsonpchallenge||[]).push([[0],{20:function(t,e,n){},22:function(t,e,n){},23:function(t,e,n){},24:function(t,e,n){"use strict";n.r(e);var o=n(0),c=n.n(o),r=n(7),i=n.n(r),s=n(2),a=n(3),u=n.n(a),l=(n(20),n(1)),f=Object(o.memo)((function(t){var e=t.toolboxConfig,n=t.workspaceRef,c=t.style,r=Object(o.useState)(null),i=Object(s.a)(r,2),a=i[0],f=i[1],b=e&&e.blocks;Object(o.useEffect)((function(){window.Blockly=u.a})),Object(o.useEffect)((function(){b&&Array.isArray(b.custom)&&b.custom.forEach((function(t){u.a.Blocks[t.type]={init:function(){this.jsonInit(t)}},u.a.JavaScript[t.type]=t.generatorCallback}))}),[a,b]);var p=Object(o.useMemo)((function(){if(b&&(b.builtin||b.custom)){var t={kind:"flyoutToolbox",contents:[]};return b.builtin&&Array.isArray(b.builtin)&&b.builtin.forEach((function(e){return t.contents.push({kind:"block",type:e})})),b.custom&&Array.isArray(b.custom)&&b.custom.forEach((function(e){var n=e.type;return t.contents.push({kind:"block",type:n})})),t}}),[b]);return Object(o.useEffect)((function(){var t=u.a.inject(document.querySelector(".blockly-div"),{toolbox:p,trashcan:!0});return f(t),t.dispose.bind(t)}),[p]),Object(o.useEffect)((function(){n.current=a}),[a,n]),Object(l.jsx)("div",{className:"blockly-div",style:c})})),b=(n(22),{type:"movement_forward",message0:"forward",previousStatement:null,nextStatement:null,colour:285,tooltip:"Moves one step forward",helpUrl:"",generatorCallback:function(){return"forward();\n"}}),p={type:"movement_rotate",message0:"turn %1 %2",args0:[{type:"input_dummy"},{type:"field_dropdown",name:"direction",options:[["left \u21ba","L"],["right \u21bb","R"]]}],inputsInline:!0,previousStatement:null,nextStatement:null,colour:285,tooltip:"Turn to the specified direction",helpUrl:"",generatorCallback:function(t){return"L"===t.getFieldValue("direction")?"turnLeft();\n":"turnRight();\n"}},m=[{toolbox:{blocks:{builtin:[],custom:[b,p]}},map:{size:{rows:20,columns:20},path:[[9,10],[10,10],[11,10]],start:[9,10],finish:[11,10]}}];n(23);function d(t){var e=t.gameRef,n=t.map,c=t.player,r=Object(o.useState)(0),i=Object(s.a)(r,2),a=i[0],u=i[1],f=Object(o.useState)(),b=Object(s.a)(f,2)[1];Object(o.useEffect)((function(){n.start&&(c.position[0]=n.start[0],c.position[1]=n.start[1])}),[n.start]);var p=Object(o.useCallback)((function(){b({})}),[b]),m=Object(o.useCallback)((function(){console.log({player:c});var t=Math.abs(c.angle)%360;0===t&&c.position[0]+1<n.size.columns?c.position[0]++:90===t&&c.position[1]?c.position[1]--:180===t&&c.position[0]?c.position[0]--:270===t&&c.position[1]+1<n.size.rows&&c.position[1]++,p(),console.log("exec: forward ".concat(c.position))}),[p,c,n.size]),d=Object(o.useCallback)((function(){c.angle=c.angle+90,p(),console.log("exec: turnLeft ".concat(c.angle))}),[p,c]),j=Object(o.useCallback)((function(){c.angle=c.angle-90,p(),console.log("exec: turnRight ".concat(c.angle))}),[p,c]),h=Object(o.useMemo)((function(){return{forward:m,turnLeft:d,turnRight:j}}),[m,d,j]),O=Object(o.useCallback)((function(t,e){Object.keys(h).forEach((function(n){t.setProperty(e,n,t.createNativeFunction(h[n]))}))}),[h]);Object(o.useEffect)((function(){e.current={interpreterInitHandler:O}}),[e,O]),Object(o.useEffect)((function(){function t(){var t=window.getComputedStyle(document.querySelector(".game .map")).width;u(parseInt(t)||0)}return t(),window.addEventListener("resize",t),function(){return window.removeEventListener("resize",t)}}),[u]);for(var g=[],v=n.size&&n.size.rows?n.size.rows:10,y=n.size&&n.size.columns?n.size.columns:10,w=0;w<v;w++)g[w]=[],g[w].length=y;for(var k=function(t){for(var e=function(e){var o=n.path.find((function(n){return n[0]===e&&n[1]===t}));g[t][e]=o?"path":"extern"},o=0;o<y;o++)e(o)},x=0;x<v;x++)k(x);return n.start&&(g[n.start[1]][n.start[0]]="start"),n.finish&&(g[n.finish[1]][n.finish[0]]="finish"),Object(l.jsx)("div",{className:"game",children:Object(l.jsxs)("div",{className:"map",style:{"--columns":y,"--rows":v,"--map-width":a},children:[g.map((function(t,e){return Object(l.jsx)("div",{className:"row",children:t.map((function(t,e){return Object(l.jsx)("div",{className:"column ".concat(t),children:"finish"===t?"\u2690":""},"column-".concat(e))}))},"row-".concat(e))})),Object(l.jsx)("div",{className:"player",style:{"--column":c.position[0],"--row":c.position[1],"--angle":-c.angle},children:"\u27a4"})]})})}function j(){var t=Object(o.useState)(0),e=Object(s.a)(t,2),n=e[0],c=(e[1],Object(o.useRef)(null)),r=Object(o.useRef)(null),i=Object(o.useMemo)((function(){return{angle:0,position:[0,0]}}),[]),a=Object(o.useMemo)((function(){return m[n]&&m[n].toolbox}),[n]),b=Object(o.useMemo)((function(){return m[n]&&m[n].map}),[n]);return Object(l.jsxs)("div",{className:"app",children:[Object(l.jsxs)("div",{className:"game-button-container",children:[Object(l.jsx)(d,{gameRef:r,map:b,player:i}),Object(l.jsx)("button",{onClick:function(){if(c.current){var t=u.a.JavaScript.workspaceToCode(c.current),e=new window.Interpreter(t,r.current&&r.current.interpreterInitHandler);!function t(){e.step()&&setTimeout(t,200)}()}},className:"run-button",children:"Run"})]}),Object(l.jsx)(f,{toolboxConfig:a,workspaceRef:c})]})}i.a.render(Object(l.jsx)(c.a.StrictMode,{children:Object(l.jsx)(j,{})}),document.getElementById("root"))}},[[24,1,2]]]);
//# sourceMappingURL=main.fa85d0cc.chunk.js.map