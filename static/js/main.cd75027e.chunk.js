(this.webpackJsonpchallenge=this.webpackJsonpchallenge||[]).push([[0],{20:function(t,e,n){},22:function(t,e,n){},23:function(t,e,n){},24:function(t,e,n){},25:function(t,e,n){},26:function(t,e,n){"use strict";n.r(e);var r=n(0),i=n.n(r),o=n(7),a=n.n(o),s=n(2),c=n(3),u=n.n(c),l=(n(20),n(1)),p=Object(r.memo)((function(t){var e=t.blocklyToolboxConfig,n=t.blocklyWorkspaceRef,i=t.style,o=Object(r.useState)(null),a=Object(s.a)(o,2),c=a[0],p=a[1],f=e&&e.blocks;Object(r.useEffect)((function(){window.Blockly=u.a})),Object(r.useEffect)((function(){f&&Array.isArray(f.custom)&&f.custom.forEach((function(t){u.a.Blocks[t.type]={init:function(){this.jsonInit(t)}},u.a.JavaScript[t.type]=t.generatorCallback}))}),[c,f]);var h=Object(r.useMemo)((function(){if(f&&(f.builtin||f.custom)){var t={kind:"flyoutToolbox",contents:[]};return f.builtin&&Array.isArray(f.builtin)&&f.builtin.forEach((function(e){return t.contents.push({kind:"block",type:e})})),f.custom&&Array.isArray(f.custom)&&f.custom.forEach((function(e){var n=e.type;return t.contents.push({kind:"block",type:n})})),t}}),[f]);return Object(r.useEffect)((function(){var t=u.a.inject(document.querySelector(".blockly-div"),{toolbox:h,trashcan:!0});return p(t),u.a.JavaScript.STATEMENT_PREFIX="highlightBlock(%1);\n",u.a.JavaScript.addReservedWords("highlightBlock"),t.dispose.bind(t)}),[h]),Object(r.useEffect)((function(){n.current=c}),[c,n]),Object(l.jsx)("div",{className:"blockly-div",style:i})})),f=(n(22),{type:"movement_forward",message0:"forward",previousStatement:null,nextStatement:null,colour:285,tooltip:"Moves one step forward",helpUrl:"",generatorCallback:function(){return"forward();\n"}}),h={type:"movement_rotate",message0:"turn %1 %2",args0:[{type:"input_dummy"},{type:"field_dropdown",name:"direction",options:[["left \u21ba","L"],["right \u21bb","R"]]}],inputsInline:!0,previousStatement:null,nextStatement:null,colour:285,tooltip:"Turn to the specified direction",helpUrl:"",generatorCallback:function(t){return"L"===t.getFieldValue("direction")?"turnLeft();\n":"turnRight();\n"}},m={type:"controls_if_path",message0:"if path %1 %2 %3 do %4",args0:[{type:"input_dummy"},{type:"field_dropdown",name:"direction",options:[["ahead","A"],["to the left \u21ba","L"],["to the right \u21bb","R"]]},{type:"input_dummy"},{type:"input_statement",name:"statement"}],inputsInline:!0,previousStatement:null,nextStatement:null,colour:210,tooltip:"Execute the 'do' statement if is possible to go to the specified direction",helpUrl:"",generatorCallback:function(t){var e=t.getFieldValue("direction");return"if (".concat("A"===e?"isPathForward()":"L"===e?"isPathToLeft()":"isPathToRight()",") {\n  ").concat(window.Blockly.JavaScript.statementToCode(t,"statement")||"","\n}")}},d={type:"controls_repeat_until_reach_end",message0:"repeat until \u2690 %1 do %2",args0:[{type:"input_dummy"},{type:"input_statement",name:"statement"}],previousStatement:null,nextStatement:null,colour:120,tooltip:"Repeat the inside code until end is reached",helpUrl:"",generatorCallback:function(t){return"while (notDone()) {\n  ".concat(window.Blockly.JavaScript.statementToCode(t,"statement")||"","\n}")}},b=[{toolbox:{blocks:{builtin:[],custom:[f,h]}},map:{size:{rows:20,columns:20},path:[[9,10],[10,10],[11,10]],start:[9,10],finish:[11,10]}},{toolbox:{blocks:{builtin:[],custom:[f,h,d]}},map:{size:{rows:20,columns:20},path:[[9,10],[10,10],[11,10],[11,9],[11,8],[11,7],[11,6],[11,5]],start:[9,10],finish:[11,5]}},{toolbox:{blocks:{builtin:[],custom:[f,h,m,d]}},map:{size:{rows:20,columns:20},path:[[9,10],[10,10],[11,10],[11,9],[11,8],[11,7],[11,6],[11,5],[12,5],[13,5],[14,5]],start:[9,10],finish:[14,5]}}];n(23);function y(t){var e=t.gameStatus,n=t.map,i=t.player,o=Object(r.useState)(0),a=Object(s.a)(o,2),c=a[0],u=a[1];Object(r.useEffect)((function(){function t(){var t=window.getComputedStyle(document.querySelector(".game .map")).width;u(parseInt(t)||0)}return t(),window.addEventListener("resize",t),function(){return window.removeEventListener("resize",t)}}),[u]);var p=n.size&&n.size.rows?n.size.rows:10,f=n.size&&n.size.columns?n.size.columns:10,h=function(t){for(var e=t.map,n=t.rows,r=t.columns,i=[],o=0;o<n;o++)i[o]=[],i[o].length=r;for(var a=function(t){for(var n=function(n){var r=e.path.find((function(e){return e[0]===n&&e[1]===t}));i[t][n]=r?"path":"extern"},o=0;o<r;o++)n(o)},s=0;s<n;s++)a(s);return e.start&&(i[e.start[1]][e.start[0]]="start"),e.finish&&(i[e.finish[1]][e.finish[0]]="finish"),i}({map:n,rows:p,columns:f});return Object(l.jsxs)("div",{className:"map",style:{"--columns":f,"--rows":p,"--map-width":c},children:[h.map((function(t,e){return Object(l.jsx)("div",{className:"row",children:t.map((function(t,e){return Object(l.jsx)("div",{className:"column ".concat(t),children:"finish"===t?"\u2690":""},"column-".concat(e))}))},"row-".concat(e))})),Object(l.jsx)("div",{className:"player ".concat(e||""),style:{"--column":i.position[0],"--row":i.position[1],"--angle":-i.angle},children:"\u27a4"})]})}function g(t){var e=t.player,n=t.map;return!!(e&&Array.isArray(e.position)&&n&&Array.isArray(n.finish))&&(e.position[0]===n.finish[0]&&e.position[1]===n.finish[1])}function j(t,e){var n=Object(s.a)(t,2),r=n[0],i=n[1];return!!Array.isArray(e)&&e.find((function(t){return t[0]===r&&t[1]===i}))}function v(t,e,n){t=Math.abs(t%360+360)%360;var r=e.position[0],i=e.position[1],o=n.size,a=o.columns,s=o.rows;return 0===t?r<a-1&&j([r+1,i],n.path):90===t?i>0&&j([r,i-1],n.path):180===t?r>0&&j([r-1,i],n.path):270===t&&(i<s-1&&j([r,i+1],n.path))}var w={forward:function(){this.workspace.lastExecutedFunction="forward";var t=Math.abs(this.player.angle%360+360)%360,e=this.player.position[0],n=this.player.position[1],r=this.map.size,i=r.columns,o=r.rows;0===t&&e+1<i?this.player.position[0]++:90===t&&n?this.player.position[1]--:180===t&&e?this.player.position[0]--:270===t&&n+1<o&&this.player.position[1]++,this.refresh()},turnLeft:function(){this.workspace.lastExecutedFunction="turnLeft",this.player.angle+=90,this.refresh()},turnRight:function(){this.workspace.lastExecutedFunction="turnRight",this.player.angle-=90,this.refresh()},notDone:function(){return this.workspace.lastExecutedFunction="notDone",!g({player:this.player,map:this.map})},isPathForward:function(){return this.workspace.lastExecutedFunction="isPathForward",v(this.player.angle,this.player,this.map)},isPathToLeft:function(){return this.workspace.lastExecutedFunction="isPathToLeft",v(this.player.angle+90,this.player,this.map)},isPathToRight:function(){return this.workspace.lastExecutedFunction="isPathToRight",v(this.player.angle-90,this.player,this.map)},highlightBlock:function(t){this.workspace.highlightBlock(t)}};function k(t){var e=t.player,n=t.map;if(!e||!Array.isArray(e.position)||!n||!Array.isArray(n.path))return!1;for(var r=0;r<n.path.length;r++)if(n.path[r][0]===e.position[0]&&n.path[r][1]===e.position[1])return!1;return!0}n(24);function O(t){var e=t.gameRef,n=t.gameStatus,i=t.onGameStatusChange,o=t.map,a=t.player,c=t.blocklyWorkspaceRef,u=Object(r.useState)(),p=Object(s.a)(u,2)[1];Object(r.useEffect)((function(){o.start&&(a.position[0]=o.start[0],a.position[1]=o.start[1])}),[o,a]);var f=Object(r.useCallback)((function(){k({player:a,map:o})&&i("collision"),p({})}),[p,i,a,o]);return e.current={interpreterInitHandler:function(t,e){var n={player:a,map:o,workspace:c&&c.current,refresh:f};Object.keys(w).forEach((function(r){t.setProperty(e,r,t.createNativeFunction(w[r].bind(n)))}))}},Object(l.jsx)("div",{className:"game",children:Object(l.jsx)(y,{gameStatus:n,player:a,map:o})})}n(25);function x(t){for(var e=t.total,n=t.current,r=t.onChange,i=n-2<1?1:n-2,o=i+4>e?e:i+4,a=[],s=i;s<=o;s++)a.push(s);return Object(l.jsx)("ul",{className:"paging-list",children:a.map((function(t){return Object(l.jsx)("li",{className:t===n?"selected":"",onClick:function(){return r(t)},children:t},"".concat(t))}))})}function S(t){return{angle:0,position:[Array.isArray(t)&&t[0]||0,Array.isArray(t)&&t[1]||0]}}function E(){var t=Object(r.useState)(2),e=Object(s.a)(t,2),n=e[0],i=e[1],o=Object(r.useState)("stop"),a=Object(s.a)(o,2),c=a[0],f=a[1],h=Object(r.useRef)(null),m=Object(r.useRef)(null),d=Object(r.useMemo)(S,[]),y=Object(r.useMemo)((function(){return{status:"stop"}}),[]);Object(r.useEffect)((function(){y.status=c}),[c,y]),Object(r.useEffect)((function(){h.current&&h.current.highlightBlock()}),[c]);var j=Object(r.useMemo)((function(){return b[n]&&b[n].toolbox}),[n]),v=Object(r.useMemo)((function(){return b[n]&&b[n].map}),[n]);function w(){Object.assign(d,S(b[n].map.start)),f("stop")}var E={stop:function(){if(h.current){var t=u.a.JavaScript.workspaceToCode(h.current),e=new window.Interpreter(t,m.current&&m.current.interpreterInitHandler);y.status="running",f("running"),function t(){"running"===y.status&&(e.step()?setTimeout(t,function(){var t=["forward","turnLeft","turnRight"].find((function(t){return t===h.current.lastExecutedFunction}));return h.current.lastExecutedFunction="",t}()?500:0):k({player:d,map:v})?f("collision"):g({player:d,map:v})?f("finish"):f("fail"))}()}},running:w,collision:w,fail:w,finish:function(){n+1<b.length&&(i(n+1),Object.assign(d,S(b[n].map.start)),f("stop"))}};return Object(l.jsxs)("div",{className:"app",children:[Object(l.jsxs)("div",{className:"game-button-container",children:[Object(l.jsx)(x,{total:b.length,current:n+1,onChange:function(t){i(t-1),Object.assign(d,S(b[n].map.start)),f("stop")}}),Object(l.jsx)(O,{gameRef:m,gameStatus:c,onGameStatusChange:f,map:v,player:d,blocklyWorkspaceRef:h}),Object(l.jsx)("button",{onClick:E[c],className:"run-button ".concat(c)})]}),Object(l.jsx)(p,{blocklyToolboxConfig:j,blocklyWorkspaceRef:h})]})}a.a.render(Object(l.jsx)(i.a.StrictMode,{children:Object(l.jsx)(E,{})}),document.getElementById("root"))}},[[26,1,2]]]);
//# sourceMappingURL=main.cd75027e.chunk.js.map